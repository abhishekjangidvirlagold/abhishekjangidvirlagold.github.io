<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Virla Rate Poster</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#eef2f7;
}
#loginPage{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-box{
  background:#fff;
  padding:30px;
  width:320px;
  border-radius:10px;
  box-shadow:0 15px 30px rgba(0,0,0,.2);
}
.login-box input{
  width:100%;
  padding:12px;
  margin:12px 0;
}
.login-box button{
  width:100%;
  padding:12px;
  background:#0b4da2;
  color:#fff;
  border:none;
}
.login-box p{color:red;text-align:center;display:none;}

#appPage{display:none;padding:20px;}
.card{
  max-width:1000px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
}
canvas{
  display:block;
  margin:20px auto;
  max-width:420px;
  width:100%;
}
#downloadLink{
  display:none;
  margin:10px auto;
  width:max-content;
  background:#0b4da2;
  color:#fff;
  padding:10px 18px;
  border-radius:6px;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="loginPage">
  <div class="login-box">
    <h3 style="text-align:center">Secure Login</h3>
    <input type="password" id="passwordInput" placeholder="Password">
    <button onclick="checkPassword()">Login</button>
    <p id="loginError">Invalid password</p>
  </div>
</div>

<div id="appPage">
  <div class="card">
    <label>Date</label>
    <input type="date" id="currentDate"><br><br>

    <label>Base Price</label>
    <input type="text" id="baseRate" value="53500"><br><br>

    <button onclick="generatePoster()">Generate Poster</button>

    <canvas id="posterCanvas"></canvas>
    <a id="downloadLink">Download Poster</a>
  </div>
</div>

<script>
/* PASSWORD */
const PASSWORD_HASH =
"490cfee36bc2aaf4af9020e63d9eb75c38a8e4fa68ea309a7be94e1420315e5b";

async function sha256(t){
  const b = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(t));
  return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

async function checkPassword(){
  const h = await sha256(passwordInput.value);
  if(h===PASSWORD_HASH){
    loginPage.style.display="none";
    appPage.style.display="block";
    initPoster();
  }else loginError.style.display="block";
}

/* POSTER */
const canvas=document.getElementById("posterCanvas");
const ctx=canvas.getContext("2d");
const img=new Image();

function initPoster(){
  currentDate.value=new Date().toISOString().split("T")[0];
  img.src="Virla_Blank_Poster.jpg";
  img.onload=()=>{
    canvas.width=img.width;
    canvas.height=img.height;
    drawPoster();
  };
}

function drawPoster(){
  ctx.drawImage(img,0,0);

  const date=currentDate.value;
  const rate=baseRate.value;

  /* ===== EXACT COORDINATES (LOCKED) ===== */
  const dateX = 420;   // LEFT strip ke andar
  const dateY = 520;   // BLUE strip ke center

  const priceX = 2350; // ₹ column center
  const priceY = 980;  // 12mm row

  /* FONT MATCH */
  ctx.textAlign="center";

  ctx.fillStyle="#ffffff";
  ctx.font="bold 42px Arial";
  ctx.fillText(`Date - ${formatDate(date)}`,dateX,dateY);

  ctx.fillStyle="#20374D";
  ctx.font="bold 48px Arial";
  ctx.fillText(`₹ ${rate}/-`,priceX,priceY);

  /* DOWNLOAD */
  const fname=`Virla Rate ${formatFileDate(date)}.jpg`;
  downloadLink.href=canvas.toDataURL("image/jpeg",0.95);
  downloadLink.download=fname;
  downloadLink.style.display="block";
}

function generatePoster(){ drawPoster(); }

function formatDate(d){
  const [y,m,dd]=d.split("-");
  return `${dd}/${m}/${y}`;
}
function formatFileDate(d){
  const [y,m,dd]=d.split("-");
  return `${dd}-${m}-${y}`;
}
</script>

</body>
</html>
